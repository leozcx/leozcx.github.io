# Why immutable

Immutable，不可变的：对象一旦创建，就不能再改变；有什么用呢？让开发更简单。看下面的例子：

```javascript
let params = {
  a: 1
}
...
function fn1 (payload) {
  payload.b = 2 // 修改了外面的params
  ...
}
```

逻辑需要我们在函数体内新增了属性b，同时无意中把外面的params也同时修改了；如果我们在外面的逻辑中需要依赖属性b，那我们可能很难判断b是在哪里修改的，这样引起的bug会很难修复；我们不应该在函数内修改传过来的参数，但你并没有规则真的禁止你这样做；实际上这样的代码很常见。结果就是，程序出了bug，我们可能花很长的时间寻找对象都在哪里被修改，无形中降低了开发效率。

另外一个好处是cache。现代的很多前端MVVM框架接管了将model渲染到view的工作，其中一个优化就是：如果model没有变，那么就不需要更新view。比如下面的例子：

```javascript
let profile = {
  name: 'Leo',
  friends: [
    {
      id: 103742,
      name: 'Cat'
    },
    ...
  ]
}

profile.friends.push({id: 3243, name: 'Dog'})
render(profile)
function render(profile) {
  // 这样是不行的
  if (profile === _lastProfile)
    return
  ...
}
```

我们希望当profile没有变化的时候，不重新渲染view，所以判断当前的profile与上一次的profile是否相等。我们知道这样是行不通的，因为在对象是可变的情况下，即使内容发生了变化，它们的引用还是相等，这就导致即使真的发生了变化，view也得不到更新。

好了，让我们再来看一下对象不可变的情况下，上面2个例子会是什么情况。

```javascript
let params = {
  a: 1
}
...
function fn1 (payload) {
  payload = {...payload} // 或者Object.assign({}, payload)
  payload.b = 2 // 不会修改外面的params
  ...
}
```
我们通过对象展开运算符新生成了一个对象，对新的对象进行操作，从而保证原对象没有发生变化。


```javascript
let profile = {
  name: 'Leo',
  friends: [
    {
      id: 103742,
      name: 'Cat'
    },
    ...
  ]
}

let newProfile = {...profile}
newProfile.friends.push({id: 3243, name: 'Dog'})
render(newProfile)
function render(profile) {
  // profile和_lastProfile不是同一个引用
  if (profile === _lastProfile)
    return
  ...
}
```

这回 `===` 可以工作了。

# 性能

到这里我们可能有个疑问：每更新一次对象我们就要深拷贝一次，对象很大的时候性能会不会有问题？的确，当我们的对象包含很多属性时，比如 todos 对象包含 10000 个对象时，Object.assign的性能会有明显的下降：

```javascript
let o = {}, s = {}
for (let i = 0; i < 100000; i++) {
  o[i] = i
}
for (let i = 0; i < 10000; i++) {
  o[i] = i
}
console.time('mutable 100000')
o['100001'] = 100001
console.timeEnd('mutable 100000')
console.time('Object.assign 100000')
let o2 = Object.assign({}, o)
o2['100001'] = 100001
console.timeEnd('Object.assign 100000')
console.time('mutable 10000')
s['10001'] = 10001
console.timeEnd('mutable 10000')
console.time('Object.assign 10000')
let s2 = Object.assign({}, s)
o2['10001'] = 10001
console.timeEnd('Object.assign 10000')
```

这里，我们分别对比直接修改、`Object.assign` ，对包含10000、100000属性的对象操作消耗的时间，结果如下：

![性能](https://raw.githubusercontent.com/leozcx/leozcx.github.io/master/images/immutable1.png)

可以看到，对于10000个属性的对象，`Object.assign` 性能虽有所下降，但降的并不多；当属性达到100000时，有明显的下降。

那么，怎么才能达到既要immutable，又要性能呢？

# immutable-js

immutable-js是Facebook开源的一款实现了immutable特性的库，它通过巧妙的方式，在imutable和性能之间达到一种平衡： [Persistent data structures] (https://en.wikipedia.org/wiki/Persistent_data_structure)

## Persistent data structure

	In computing, a persistent data structure is a data structure that always preserves the previous version of itself when it is modified. Such data structures are effectively immutable, as their operations do not (visibly) update the structure in-place, but instead always yield a new updated structure.
	
简单来说，在做拷贝时，并不需要拷贝所有的属性，只需要拷贝发生变化的那些，不变的那些还可以被重用，这就是 structure sharing。

比如，我们有这样一个对象：

```javascript
const data = {
  to: 7,
  tea: 3,
  ted: 4,
  ten: 12,
  A: 15,
  i: 11,
  in: 5,
  inn: 9
}
```
我们用 [字典树Trie] (https://en.wikipedia.org/wiki/Trie) 这种数据结构保存它：
![字典树](data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiCiAgIHZlcnNpb249IjEuMCIKICAgd2lkdGg9IjQwMCIKICAgaGVpZ2h0PSIzNzUiCiAgIGlkPSJzdmcyIj4KICA8ZGVmcwogICAgIGlkPSJkZWZzNSI+CiAgICA8bWFya2VyCiAgICAgICByZWZYPSIwIgogICAgICAgcmVmWT0iMCIKICAgICAgIG9yaWVudD0iYXV0byIKICAgICAgIGlkPSJUcmlhbmdsZU91dE0iCiAgICAgICBzdHlsZT0ib3ZlcmZsb3c6dmlzaWJsZSI+CiAgICAgIDxwYXRoCiAgICAgICAgIGQ9Ik0gNS43NywwIEwgLTIuODgsNSBMIC0yLjg4LC01IEwgNS43NywwIHoiCiAgICAgICAgIHRyYW5zZm9ybT0ic2NhbGUoMC40LDAuNCkiCiAgICAgICAgIGlkPSJwYXRoMzM4MyIKICAgICAgICAgc3R5bGU9ImZpbGwtcnVsZTpldmVub2RkO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxcHQ7bWFya2VyLXN0YXJ0Om5vbmUiIC8+CiAgICA8L21hcmtlcj4KICAgIDxtYXJrZXIKICAgICAgIHJlZlg9IjAiCiAgICAgICByZWZZPSIwIgogICAgICAgb3JpZW50PSJhdXRvIgogICAgICAgaWQ9IlRyaWFuZ2xlT3V0TCIKICAgICAgIHN0eWxlPSJvdmVyZmxvdzp2aXNpYmxlIj4KICAgICAgPHBhdGgKICAgICAgICAgZD0iTSA1Ljc3LDAgTCAtMi44OCw1IEwgLTIuODgsLTUgTCA1Ljc3LDAgeiIKICAgICAgICAgdHJhbnNmb3JtPSJzY2FsZSgwLjgsMC44KSIKICAgICAgICAgaWQ9InBhdGgzMzgwIgogICAgICAgICBzdHlsZT0iZmlsbC1ydWxlOmV2ZW5vZGQ7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjFwdDttYXJrZXItc3RhcnQ6bm9uZSIgLz4KICAgIDwvbWFya2VyPgogIDwvZGVmcz4KICA8cGF0aAogICAgIGQ9Ik0gMjI1LDM3IEEgMjYsMjYgMCAxIDEgMTczLDM3IEEgMjYsMjYgMCAxIDEgMjI1LDM3IHoiCiAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMSwwKSIKICAgICBpZD0icGF0aDE4OTEiCiAgICAgc3R5bGU9Im9wYWNpdHk6MTtmaWxsOiNmZmZmZmY7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOm5vbnplcm87c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuODc1O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1kYXNob2Zmc2V0OjA7c3Ryb2tlLW9wYWNpdHk6MSIgLz4KICA8dXNlCiAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTEwMCw5MCkiCiAgICAgaWQ9InVzZTI3NzkiCiAgICAgeD0iMCIKICAgICB5PSIwIgogICAgIHdpZHRoPSI0MDAiCiAgICAgaGVpZ2h0PSIzNzUiCiAgICAgeGxpbms6aHJlZj0iI3BhdGgxODkxIiAvPgogIDx1c2UKICAgICB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtNDAsMTgwKSIKICAgICBpZD0idXNlMjc4MSIKICAgICB4PSIwIgogICAgIHk9IjAiCiAgICAgd2lkdGg9IjQwMCIKICAgICBoZWlnaHQ9IjM3NSIKICAgICB4bGluazpocmVmPSIjcGF0aDE4OTEiIC8+CiAgPHVzZQogICAgIHRyYW5zZm9ybT0idHJhbnNsYXRlKDMwLDI3MikiCiAgICAgaWQ9InVzZTI3ODMiCiAgICAgeD0iMCIKICAgICB5PSIwIgogICAgIHdpZHRoPSI0MDAiCiAgICAgaGVpZ2h0PSIzNzUiCiAgICAgeGxpbms6aHJlZj0iI3BhdGgxODkxIiAvPgogIDx1c2UKICAgICB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMDAsOTApIgogICAgIGlkPSJ1c2UyNzg1IgogICAgIHg9IjAiCiAgICAgeT0iMCIKICAgICB3aWR0aD0iNDAwIgogICAgIGhlaWdodD0iMzc1IgogICAgIHhsaW5rOmhyZWY9IiNwYXRoMTg5MSIgLz4KICA8dXNlCiAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTYwLDE4MCkiCiAgICAgaWQ9InVzZTI3ODciCiAgICAgeD0iMCIKICAgICB5PSIwIgogICAgIHdpZHRoPSI0MDAiCiAgICAgaGVpZ2h0PSIzNzUiCiAgICAgeGxpbms6aHJlZj0iI3BhdGgxODkxIiAvPgogIDx1c2UKICAgICB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMTYwLDE4MCkiCiAgICAgaWQ9InVzZTI3ODkiCiAgICAgeD0iMCIKICAgICB5PSIwIgogICAgIHdpZHRoPSI0MDAiCiAgICAgaGVpZ2h0PSIzNzUiCiAgICAgeGxpbms6aHJlZj0iI3BhdGgxODkxIiAvPgogIDx1c2UKICAgICB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMTEyLDI3Mi4wMDA1KSIKICAgICBpZD0idXNlMjc5MSIKICAgICB4PSIwIgogICAgIHk9IjAiCiAgICAgd2lkdGg9IjQwMCIKICAgICBoZWlnaHQ9IjM3NSIKICAgICB4bGluazpocmVmPSIjcGF0aDE4OTEiIC8+CiAgPHVzZQogICAgIHRyYW5zZm9ybT0idHJhbnNsYXRlKDEwNSwyNzgpIgogICAgIGlkPSJ1c2UyNzkzIgogICAgIHg9IjAiCiAgICAgeT0iMCIKICAgICB3aWR0aD0iNDAwIgogICAgIGhlaWdodD0iMzc1IgogICAgIHhsaW5rOmhyZWY9IiNwYXRoMTg5MSIgLz4KICA8dGV4dAogICAgIHg9IjI2MiIKICAgICB5PSI3NyIKICAgICBpZD0idGV4dDI4MDMiCiAgICAgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIKICAgICBzdHlsZT0iZm9udC1zaXplOjI0cHg7Zm9udC1zdHlsZTpub3JtYWw7Zm9udC12YXJpYW50Om5vcm1hbDtmb250LXdlaWdodDpub3JtYWw7Zm9udC1zdHJldGNoOm5vcm1hbDt0ZXh0LWFsaWduOmNlbnRlcjtsaW5lLWhlaWdodDoxMjUlO3dyaXRpbmctbW9kZTpsci10Yjt0ZXh0LWFuY2hvcjptaWRkbGU7ZmlsbDojMDAwMDAwO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDoxcHg7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MTtmb250LWZhbWlseTpBcmlhbCI+PHRzcGFuCiAgICAgICB4PSIyNjIiCiAgICAgICB5PSI3NyIKICAgICAgIGlkPSJ0c3BhbjI4MDUiPmk8L3RzcGFuPjwvdGV4dD4KICA8dGV4dAogICAgIHg9IjE0MCIKICAgICB5PSI3NyIKICAgICBpZD0idGV4dDI4MDciCiAgICAgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIKICAgICBzdHlsZT0iZm9udC1zaXplOjI0cHg7Zm9udC1zdHlsZTpub3JtYWw7Zm9udC12YXJpYW50Om5vcm1hbDtmb250LXdlaWdodDpub3JtYWw7Zm9udC1zdHJldGNoOm5vcm1hbDt0ZXh0LWFsaWduOmNlbnRlcjtsaW5lLWhlaWdodDoxMjUlO3dyaXRpbmctbW9kZTpsci10Yjt0ZXh0LWFuY2hvcjptaWRkbGU7ZmlsbDojMDAwMDAwO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDoxcHg7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MTtmb250LWZhbWlseTpBcmlhbCI+PHRzcGFuCiAgICAgICB4PSIxNDAiCiAgICAgICB5PSI3NyIKICAgICAgIGlkPSJ0c3BhbjI4MDkiPnQ8L3RzcGFuPjwvdGV4dD4KICA8dGV4dAogICAgIHg9IjE0MSIKICAgICB5PSIxNzEiCiAgICAgaWQ9InRleHQyODExIgogICAgIHhtbDpzcGFjZT0icHJlc2VydmUiCiAgICAgc3R5bGU9ImZvbnQtc2l6ZToyNHB4O2ZvbnQtc3R5bGU6bm9ybWFsO2ZvbnQtdmFyaWFudDpub3JtYWw7Zm9udC13ZWlnaHQ6bm9ybWFsO2ZvbnQtc3RyZXRjaDpub3JtYWw7dGV4dC1hbGlnbjpjZW50ZXI7bGluZS1oZWlnaHQ6MTI1JTt3cml0aW5nLW1vZGU6bHItdGI7dGV4dC1hbmNob3I6bWlkZGxlO2ZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MXB4O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjE7Zm9udC1mYW1pbHk6QXJpYWwiPjx0c3BhbgogICAgICAgeD0iMTQxIgogICAgICAgeT0iMTcxIgogICAgICAgaWQ9InRzcGFuMjgxMyI+ZTwvdHNwYW4+PC90ZXh0PgogIDx0ZXh0CiAgICAgeD0iNTYiCiAgICAgeT0iMTcxIgogICAgIGlkPSJ0ZXh0MjgxNSIKICAgICB4bWw6c3BhY2U9InByZXNlcnZlIgogICAgIHN0eWxlPSJmb250LXNpemU6MjRweDtmb250LXN0eWxlOm5vcm1hbDtmb250LXZhcmlhbnQ6bm9ybWFsO2ZvbnQtd2VpZ2h0Om5vcm1hbDtmb250LXN0cmV0Y2g6bm9ybWFsO3RleHQtYWxpZ246Y2VudGVyO2xpbmUtaGVpZ2h0OjEyNSU7d3JpdGluZy1tb2RlOmxyLXRiO3RleHQtYW5jaG9yOm1pZGRsZTtmaWxsOiMwMDAwMDA7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjFweDtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxO2ZvbnQtZmFtaWx5OkFyaWFsIj48dHNwYW4KICAgICAgIHg9IjU2IgogICAgICAgeT0iMTcxIgogICAgICAgaWQ9InRzcGFuMjgxNyI+bzwvdHNwYW4+PC90ZXh0PgogIDx0ZXh0CiAgICAgeD0iMzQzIgogICAgIHk9IjE3MSIKICAgICBpZD0idGV4dDI4MTkiCiAgICAgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIKICAgICBzdHlsZT0iZm9udC1zaXplOjI0cHg7Zm9udC1zdHlsZTpub3JtYWw7Zm9udC12YXJpYW50Om5vcm1hbDtmb250LXdlaWdodDpub3JtYWw7Zm9udC1zdHJldGNoOm5vcm1hbDt0ZXh0LWFsaWduOmNlbnRlcjtsaW5lLWhlaWdodDoxMjUlO3dyaXRpbmctbW9kZTpsci10Yjt0ZXh0LWFuY2hvcjptaWRkbGU7ZmlsbDojMDAwMDAwO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDoxcHg7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MTtmb250LWZhbWlseTpBcmlhbCI+PHRzcGFuCiAgICAgICB4PSIzNDMiCiAgICAgICB5PSIxNzEiCiAgICAgICBpZD0idHNwYW4yODIxIj5uPC90c3Bhbj48L3RleHQ+CiAgPHRleHQKICAgICB4PSIzMTgiCiAgICAgeT0iMjczIgogICAgIGlkPSJ0ZXh0MjgyMyIKICAgICB4bWw6c3BhY2U9InByZXNlcnZlIgogICAgIHN0eWxlPSJmb250LXNpemU6MjRweDtmb250LXN0eWxlOm5vcm1hbDtmb250LXZhcmlhbnQ6bm9ybWFsO2ZvbnQtd2VpZ2h0Om5vcm1hbDtmb250LXN0cmV0Y2g6bm9ybWFsO3RleHQtYWxpZ246Y2VudGVyO2xpbmUtaGVpZ2h0OjEyNSU7d3JpdGluZy1tb2RlOmxyLXRiO3RleHQtYW5jaG9yOm1pZGRsZTtmaWxsOiMwMDAwMDA7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjFweDtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxO2ZvbnQtZmFtaWx5OkFyaWFsIj48dHNwYW4KICAgICAgIHg9IjMxOCIKICAgICAgIHk9IjI3MyIKICAgICAgIGlkPSJ0c3BhbjI4MjUiPm48L3RzcGFuPjwvdGV4dD4KICA8dGV4dAogICAgIHg9IjIxOCIKICAgICB5PSIyNjUiCiAgICAgaWQ9InRleHQyODI3IgogICAgIHhtbDpzcGFjZT0icHJlc2VydmUiCiAgICAgc3R5bGU9ImZvbnQtc2l6ZToyNHB4O2ZvbnQtc3R5bGU6bm9ybWFsO2ZvbnQtdmFyaWFudDpub3JtYWw7Zm9udC13ZWlnaHQ6bm9ybWFsO2ZvbnQtc3RyZXRjaDpub3JtYWw7dGV4dC1hbGlnbjpjZW50ZXI7bGluZS1oZWlnaHQ6MTI1JTt3cml0aW5nLW1vZGU6bHItdGI7dGV4dC1hbmNob3I6bWlkZGxlO2ZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MXB4O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjE7Zm9udC1mYW1pbHk6QXJpYWwiPjx0c3BhbgogICAgICAgeD0iMjE4IgogICAgICAgeT0iMjY1IgogICAgICAgaWQ9InRzcGFuMjgyOSI+bjwvdHNwYW4+PC90ZXh0PgogIDx0ZXh0CiAgICAgeD0iMTAwIgogICAgIHk9IjI2NSIKICAgICBpZD0idGV4dDI4MzEiCiAgICAgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIKICAgICBzdHlsZT0iZm9udC1zaXplOjI0cHg7Zm9udC1zdHlsZTpub3JtYWw7Zm9udC12YXJpYW50Om5vcm1hbDtmb250LXdlaWdodDpub3JtYWw7Zm9udC1zdHJldGNoOm5vcm1hbDt0ZXh0LWFsaWduOmNlbnRlcjtsaW5lLWhlaWdodDoxMjUlO3dyaXRpbmctbW9kZTpsci10Yjt0ZXh0LWFuY2hvcjptaWRkbGU7ZmlsbDojMDAwMDAwO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDoxcHg7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MTtmb250LWZhbWlseTpBcmlhbCI+PHRzcGFuCiAgICAgICB4PSIxMDAiCiAgICAgICB5PSIyNjUiCiAgICAgICBpZD0idHNwYW4yODMzIj5hPC90c3Bhbj48L3RleHQ+CiAgPHRleHQKICAgICB4PSI5OS45MDAzOTEiCiAgICAgeT0iMTM0LjY2NDA2IgogICAgIGlkPSJ0ZXh0MjgzNSIKICAgICB4bWw6c3BhY2U9InByZXNlcnZlIgogICAgIHN0eWxlPSJmb250LXNpemU6MjRweDtmb250LXN0eWxlOm5vcm1hbDtmb250LXZhcmlhbnQ6bm9ybWFsO2ZvbnQtd2VpZ2h0Om5vcm1hbDtmb250LXN0cmV0Y2g6bm9ybWFsO3RleHQtYWxpZ246Y2VudGVyO2xpbmUtaGVpZ2h0OjEyNSU7d3JpdGluZy1tb2RlOmxyLXRiO3RleHQtYW5jaG9yOm1pZGRsZTtmaWxsOiMwMDAwMDA7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjFweDtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxO2ZvbnQtZmFtaWx5OkFyaWFsIj48dHNwYW4KICAgICAgIHg9Ijk5LjkwMDM5MSIKICAgICAgIHk9IjEzNC42NjQwNiIKICAgICAgIGlkPSJ0c3BhbjI4MzciPnQ8L3RzcGFuPjwvdGV4dD4KICA8dGV4dAogICAgIHg9IjMwMC4wMTE3MiIKICAgICB5PSIxMzUuNjk1MzEiCiAgICAgaWQ9InRleHQyODM5IgogICAgIHhtbDpzcGFjZT0icHJlc2VydmUiCiAgICAgc3R5bGU9ImZvbnQtc2l6ZToyNHB4O2ZvbnQtc3R5bGU6bm9ybWFsO2ZvbnQtdmFyaWFudDpub3JtYWw7Zm9udC13ZWlnaHQ6bm9ybWFsO2ZvbnQtc3RyZXRjaDpub3JtYWw7dGV4dC1hbGlnbjpjZW50ZXI7bGluZS1oZWlnaHQ6MTI1JTt3cml0aW5nLW1vZGU6bHItdGI7dGV4dC1hbmNob3I6bWlkZGxlO2ZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MXB4O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjE7Zm9udC1mYW1pbHk6QXJpYWwiPjx0c3BhbgogICAgICAgeD0iMzAwLjAxMTcyIgogICAgICAgeT0iMTM1LjY5NTMxIgogICAgICAgaWQ9InRzcGFuMjg0MSI+aTwvdHNwYW4+PC90ZXh0PgogIDx0ZXh0CiAgICAgeD0iMzU5Ljk4MjQyIgogICAgIHk9IjIyNS42OTUzMSIKICAgICBpZD0idGV4dDI4NDMiCiAgICAgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIKICAgICBzdHlsZT0iZm9udC1zaXplOjI0cHg7Zm9udC1zdHlsZTpub3JtYWw7Zm9udC12YXJpYW50Om5vcm1hbDtmb250LXdlaWdodDpub3JtYWw7Zm9udC1zdHJldGNoOm5vcm1hbDt0ZXh0LWFsaWduOmNlbnRlcjtsaW5lLWhlaWdodDoxMjUlO3dyaXRpbmctbW9kZTpsci10Yjt0ZXh0LWFuY2hvcjptaWRkbGU7ZmlsbDojMDAwMDAwO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDoxcHg7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MTtmb250LWZhbWlseTpBcmlhbCI+PHRzcGFuCiAgICAgICB4PSIzNTkuOTgyNDIiCiAgICAgICB5PSIyMjUuNjk1MzEiCiAgICAgICBpZD0idHNwYW4yODQ1Ij5pbjwvdHNwYW4+PC90ZXh0PgogIDx0ZXh0CiAgICAgeD0iMzA0Ljk4MjQyIgogICAgIHk9IjMyMy42OTUzMSIKICAgICBpZD0idGV4dDI4NDciCiAgICAgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIKICAgICBzdHlsZT0iZm9udC1zaXplOjI0cHg7Zm9udC1zdHlsZTpub3JtYWw7Zm9udC12YXJpYW50Om5vcm1hbDtmb250LXdlaWdodDpub3JtYWw7Zm9udC1zdHJldGNoOm5vcm1hbDt0ZXh0LWFsaWduOmNlbnRlcjtsaW5lLWhlaWdodDoxMjUlO3dyaXRpbmctbW9kZTpsci10Yjt0ZXh0LWFuY2hvcjptaWRkbGU7ZmlsbDojMDAwMDAwO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDoxcHg7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MTtmb250LWZhbWlseTpBcmlhbCI+PHRzcGFuCiAgICAgICB4PSIzMDQuOTgyNDIiCiAgICAgICB5PSIzMjMuNjk1MzEiCiAgICAgICBpZD0idHNwYW4yODQ5Ij5pbm48L3RzcGFuPjwvdGV4dD4KICA8dGV4dAogICAgIHg9IjE2MC4zNTc0MiIKICAgICB5PSIyMjQuNjQwNjIiCiAgICAgaWQ9InRleHQyODUxIgogICAgIHhtbDpzcGFjZT0icHJlc2VydmUiCiAgICAgc3R5bGU9ImZvbnQtc2l6ZToyNHB4O2ZvbnQtc3R5bGU6bm9ybWFsO2ZvbnQtdmFyaWFudDpub3JtYWw7Zm9udC13ZWlnaHQ6bm9ybWFsO2ZvbnQtc3RyZXRjaDpub3JtYWw7dGV4dC1hbGlnbjpjZW50ZXI7bGluZS1oZWlnaHQ6MTI1JTt3cml0aW5nLW1vZGU6bHItdGI7dGV4dC1hbmNob3I6bWlkZGxlO2ZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MXB4O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjE7Zm9udC1mYW1pbHk6QXJpYWwiPjx0c3BhbgogICAgICAgeD0iMTYwLjM1NzQyIgogICAgICAgeT0iMjI0LjY0MDYyIgogICAgICAgaWQ9InRzcGFuMjg1MyI+dGU8L3RzcGFuPjwvdGV4dD4KICA8dGV4dAogICAgIHg9Ijg3LjgyNDIxOSIKICAgICB5PSIzMTYuNjQxMTEiCiAgICAgaWQ9InRleHQyODU1IgogICAgIHhtbDpzcGFjZT0icHJlc2VydmUiCiAgICAgc3R5bGU9ImZvbnQtc2l6ZToyNHB4O2ZvbnQtc3R5bGU6bm9ybWFsO2ZvbnQtdmFyaWFudDpub3JtYWw7Zm9udC13ZWlnaHQ6bm9ybWFsO2ZvbnQtc3RyZXRjaDpub3JtYWw7dGV4dC1hbGlnbjpjZW50ZXI7bGluZS1oZWlnaHQ6MTI1JTt3cml0aW5nLW1vZGU6bHItdGI7dGV4dC1hbmNob3I6bWlkZGxlO2ZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MXB4O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjE7Zm9udC1mYW1pbHk6QXJpYWwiPjx0c3BhbgogICAgICAgeD0iODcuODI0MjE5IgogICAgICAgeT0iMzE2LjY0MTExIgogICAgICAgaWQ9InRzcGFuMjg1NyI+dGVhPC90c3Bhbj48L3RleHQ+CiAgPHRleHQKICAgICB4PSIyMzAuNjAzNTIiCiAgICAgeT0iMzE2LjY0MDYyIgogICAgIGlkPSJ0ZXh0Mjg1OSIKICAgICB4bWw6c3BhY2U9InByZXNlcnZlIgogICAgIHN0eWxlPSJmb250LXNpemU6MjRweDtmb250LXN0eWxlOm5vcm1hbDtmb250LXZhcmlhbnQ6bm9ybWFsO2ZvbnQtd2VpZ2h0Om5vcm1hbDtmb250LXN0cmV0Y2g6bm9ybWFsO3RleHQtYWxpZ246Y2VudGVyO2xpbmUtaGVpZ2h0OjEyNSU7d3JpdGluZy1tb2RlOmxyLXRiO3RleHQtYW5jaG9yOm1pZGRsZTtmaWxsOiMwMDAwMDA7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjFweDtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxO2ZvbnQtZmFtaWx5OkFyaWFsIj48dHNwYW4KICAgICAgIHg9IjIzMC42MDM1MiIKICAgICAgIHk9IjMxNi42NDA2MiIKICAgICAgIGlkPSJ0c3BhbjI4NjEiPnRlbjwvdHNwYW4+PC90ZXh0PgogIDx0ZXh0CiAgICAgeD0iNDAuMzI4MTI1IgogICAgIHk9IjIyNC42NDA2MiIKICAgICBpZD0idGV4dDI4NjMiCiAgICAgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIKICAgICBzdHlsZT0iZm9udC1zaXplOjI0cHg7Zm9udC1zdHlsZTpub3JtYWw7Zm9udC12YXJpYW50Om5vcm1hbDtmb250LXdlaWdodDpub3JtYWw7Zm9udC1zdHJldGNoOm5vcm1hbDt0ZXh0LWFsaWduOmNlbnRlcjtsaW5lLWhlaWdodDoxMjUlO3dyaXRpbmctbW9kZTpsci10Yjt0ZXh0LWFuY2hvcjptaWRkbGU7ZmlsbDojMDAwMDAwO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDoxcHg7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MTtmb250LWZhbWlseTpBcmlhbCI+PHRzcGFuCiAgICAgICB4PSI0MC4zMjgxMjUiCiAgICAgICB5PSIyMjQuNjQwNjIiCiAgICAgICBpZD0idHNwYW4yODY1Ij50bzwvdHNwYW4+PC90ZXh0PgogIDx0ZXh0CiAgICAgeD0iOTAuMDU0Njg4IgogICAgIHk9IjM1OS4wMjE0OCIKICAgICBpZD0idGV4dDI4NjciCiAgICAgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIKICAgICBzdHlsZT0iZm9udC1zaXplOjI4cHg7Zm9udC1zdHlsZTpub3JtYWw7Zm9udC12YXJpYW50Om5vcm1hbDtmb250LXdlaWdodDpub3JtYWw7Zm9udC1zdHJldGNoOm5vcm1hbDt0ZXh0LWFsaWduOmNlbnRlcjtsaW5lLWhlaWdodDoxMjUlO3dyaXRpbmctbW9kZTpsci10Yjt0ZXh0LWFuY2hvcjptaWRkbGU7ZmlsbDojMDAwMDk0O2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDoxcHg7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MTtmb250LWZhbWlseTpBcmlhbCI+PHRzcGFuCiAgICAgICB4PSI5MC4wNTQ2ODgiCiAgICAgICB5PSIzNTkuMDIxNDgiCiAgICAgICBpZD0idHNwYW4yODY5Ij4zPC90c3Bhbj48L3RleHQ+CiAgPHRleHQKICAgICB4PSIyMjUuMjIwNyIKICAgICB5PSIzNTkuMDIxNDgiCiAgICAgaWQ9InRleHQyODcxIgogICAgIHhtbDpzcGFjZT0icHJlc2VydmUiCiAgICAgc3R5bGU9ImZvbnQtc2l6ZToyOHB4O2ZvbnQtc3R5bGU6bm9ybWFsO2ZvbnQtdmFyaWFudDpub3JtYWw7Zm9udC13ZWlnaHQ6bm9ybWFsO2ZvbnQtc3RyZXRjaDpub3JtYWw7dGV4dC1hbGlnbjpjZW50ZXI7bGluZS1oZWlnaHQ6MTI1JTt3cml0aW5nLW1vZGU6bHItdGI7dGV4dC1hbmNob3I6bWlkZGxlO2ZpbGw6IzAwMDA5NDtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MXB4O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjE7Zm9udC1mYW1pbHk6QXJpYWwiPjx0c3BhbgogICAgICAgeD0iMjI1LjIyMDciCiAgICAgICB5PSIzNTkuMDIxNDgiCiAgICAgICBpZD0idHNwYW4yODczIj4xMjwvdHNwYW4+PC90ZXh0PgogIDx0ZXh0CiAgICAgeD0iMzIyLjA0MTAyIgogICAgIHk9IjM2MS4wMjE0OCIKICAgICBpZD0idGV4dDI4NzUiCiAgICAgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIKICAgICBzdHlsZT0iZm9udC1zaXplOjI4cHg7Zm9udC1zdHlsZTpub3JtYWw7Zm9udC12YXJpYW50Om5vcm1hbDtmb250LXdlaWdodDpub3JtYWw7Zm9udC1zdHJldGNoOm5vcm1hbDt0ZXh0LWFsaWduOmNlbnRlcjtsaW5lLWhlaWdodDoxMjUlO3dyaXRpbmctbW9kZTpsci10Yjt0ZXh0LWFuY2hvcjptaWRkbGU7ZmlsbDojMDAwMDk0O2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDoxcHg7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MTtmb250LWZhbWlseTpBcmlhbCI+PHRzcGFuCiAgICAgICB4PSIzMjIuMDQxMDIiCiAgICAgICB5PSIzNjEuMDIxNDgiCiAgICAgICBpZD0idHNwYW4yODc3Ij45PC90c3Bhbj48L3RleHQ+CiAgPHRleHQKICAgICB4PSIzOS45Nzk0OTIiCiAgICAgeT0iMjY5LjAyMTQ4IgogICAgIGlkPSJ0ZXh0Mjg3OSIKICAgICB4bWw6c3BhY2U9InByZXNlcnZlIgogICAgIHN0eWxlPSJmb250LXNpemU6MjhweDtmb250LXN0eWxlOm5vcm1hbDtmb250LXZhcmlhbnQ6bm9ybWFsO2ZvbnQtd2VpZ2h0Om5vcm1hbDtmb250LXN0cmV0Y2g6bm9ybWFsO3RleHQtYWxpZ246Y2VudGVyO2xpbmUtaGVpZ2h0OjEyNSU7d3JpdGluZy1tb2RlOmxyLXRiO3RleHQtYW5jaG9yOm1pZGRsZTtmaWxsOiMwMDAwOTQ7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjFweDtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxO2ZvbnQtZmFtaWx5OkFyaWFsIj48dHNwYW4KICAgICAgIHg9IjM5Ljk3OTQ5MiIKICAgICAgIHk9IjI2OS4wMjE0OCIKICAgICAgIGlkPSJ0c3BhbjI4ODEiPjc8L3RzcGFuPjwvdGV4dD4KICA8dGV4dAogICAgIHg9IjM1OC4wNDEwMiIKICAgICB5PSIyNjkuMDIxNDgiCiAgICAgaWQ9InRleHQyODgzIgogICAgIHhtbDpzcGFjZT0icHJlc2VydmUiCiAgICAgc3R5bGU9ImZvbnQtc2l6ZToyOHB4O2ZvbnQtc3R5bGU6bm9ybWFsO2ZvbnQtdmFyaWFudDpub3JtYWw7Zm9udC13ZWlnaHQ6bm9ybWFsO2ZvbnQtc3RyZXRjaDpub3JtYWw7dGV4dC1hbGlnbjpjZW50ZXI7bGluZS1oZWlnaHQ6MTI1JTt3cml0aW5nLW1vZGU6bHItdGI7dGV4dC1hbmNob3I6bWlkZGxlO2ZpbGw6IzAwMDA5NDtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MXB4O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjE7Zm9udC1mYW1pbHk6QXJpYWwiPjx0c3BhbgogICAgICAgeD0iMzU4LjA0MTAyIgogICAgICAgeT0iMjY5LjAyMTQ4IgogICAgICAgaWQ9InRzcGFuMjg4NSI+NTwvdHNwYW4+PC90ZXh0PgogIDx0ZXh0CiAgICAgeD0iMjk5Ljk4NjMzIgogICAgIHk9IjE3OS4wMjE0OCIKICAgICBpZD0idGV4dDI4ODkiCiAgICAgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIKICAgICBzdHlsZT0iZm9udC1zaXplOjI4cHg7Zm9udC1zdHlsZTpub3JtYWw7Zm9udC12YXJpYW50Om5vcm1hbDtmb250LXdlaWdodDpub3JtYWw7Zm9udC1zdHJldGNoOm5vcm1hbDt0ZXh0LWFsaWduOmNlbnRlcjtsaW5lLWhlaWdodDoxMjUlO3dyaXRpbmctbW9kZTpsci10Yjt0ZXh0LWFuY2hvcjptaWRkbGU7ZmlsbDojMDAwMDk0O2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDoxcHg7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MTtmb250LWZhbWlseTpBcmlhbCI+PHRzcGFuCiAgICAgICB4PSIyOTkuOTg2MzMiCiAgICAgICB5PSIxNzkuMDIxNDgiCiAgICAgICBpZD0idHNwYW4yODkxIj4xMTwvdHNwYW4+PC90ZXh0PgogIDxwYXRoCiAgICAgZD0iTSAxNzUuMzY1ODEsNTUuNjQzOTI4IEwgMTI2LjQ2MjUxLDEwNS4yNjQ2NCIKICAgICBpZD0icGF0aDI4OTMiCiAgICAgc3R5bGU9ImZpbGw6bm9uZTtmaWxsLW9wYWNpdHk6MC43NTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OTM5OTk5ODtzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLW9wYWNpdHk6MSIgLz4KICA8cGF0aAogICAgIGQ9Ik0gMTI0LjM2MTMzLDEwNy40Njc5IEwgMTI2LjU3NzUxLDk4LjU3ODI4MyBMIDEzMy4yNTA5NCwxMDUuMjUxNzIgTCAxMjQuMzYxMzMsMTA3LjQ2NzkgeiIKICAgICBpZD0icGF0aDI4OTUiCiAgICAgc3R5bGU9ImZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS4yNzUzOTE1OHB4O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1vcGFjaXR5OjEiIC8+CiAgPGcKICAgICB0cmFuc2Zvcm09Im1hdHJpeCgtMC45MDE4MzgsMC45MDE4MzgsMC45MDE4MzgsMC45MDE4MzgsNTguNTA5NCwtMTcuMjYzODgpIgogICAgIGlkPSJ1c2UyOTAxIj4KICAgIDxwYXRoCiAgICAgICBkPSJNIC01MS42MTg3OTUsMTMyLjQ2MjM3IEwgLTUxLjIyMTA0NiwxODcuMDg2MzgiCiAgICAgICBpZD0icGF0aDI0NTAiCiAgICAgICBzdHlsZT0iZmlsbDpub25lO2ZpbGwtb3BhY2l0eTowLjc1O2ZpbGwtcnVsZTpldmVub2RkO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjI1O3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utb3BhY2l0eToxIiAvPgogICAgPHBhdGgKICAgICAgIGQ9Ik0gLTUxLjE2NDQ1MiwxODkuNDcyODYgTCAtNTQuODY0MzYxLDE4My4zMTU1NSBMIC00Ny40NjQ1NDIsMTgzLjMxNTU1IEwgLTUxLjE2NDQ1MiwxODkuNDcyODYgeiIKICAgICAgIGlkPSJwYXRoMjQ1MiIKICAgICAgIHN0eWxlPSJmaWxsOiMwMDAwMDA7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOmV2ZW5vZGQ7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjFweDtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2Utb3BhY2l0eToxIiAvPgogIDwvZz4KICA8ZwogICAgIHRyYW5zZm9ybT0ibWF0cml4KDAuNzI2ODIzNywwLjQ5NjE4NTksLTAuNDk2MTg1OSwwLjcyNjgyMzcsMTg3LjA5ODI0LDgxLjA1MzEyMykiCiAgICAgaWQ9InVzZTI5MDkiPgogICAgPHBhdGgKICAgICAgIGQ9Ik0gLTUxLjYxODc5NSwxMzIuNDYyMzcgTCAtNTEuMjIxMDQ2LDE4Ny4wODYzOCIKICAgICAgIGlkPSJwYXRoMjQ1NiIKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7ZmlsbC1vcGFjaXR5OjAuNzU7ZmlsbC1ydWxlOmV2ZW5vZGQ7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuMjU7c3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1vcGFjaXR5OjEiIC8+CiAgICA8cGF0aAogICAgICAgZD0iTSAtNTEuMTY0NDUyLDE4OS40NzI4NiBMIC01NC44NjQzNjEsMTgzLjMxNTU1IEwgLTQ3LjQ2NDU0MiwxODMuMzE1NTUgTCAtNTEuMTY0NDUyLDE4OS40NzI4NiB6IgogICAgICAgaWQ9InBhdGgyNDU4IgogICAgICAgc3R5bGU9ImZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MXB4O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1vcGFjaXR5OjEiIC8+CiAgPC9nPgogIDx1c2UKICAgICB0cmFuc2Zvcm09Im1hdHJpeCgtMSwwLDAsMSwxOTkuODYxNSwwKSIKICAgICBpZD0idXNlMjkxMSIKICAgICB4PSIwIgogICAgIHk9IjAiCiAgICAgd2lkdGg9IjQwMCIKICAgICBoZWlnaHQ9IjM3NSIKICAgICB4bGluazpocmVmPSIjdXNlMjkwOSIgLz4KICA8dXNlCiAgICAgdHJhbnNmb3JtPSJtYXRyaXgoLTEsMCwwLDEsMzk5LjE1NDQsMCkiCiAgICAgaWQ9InVzZTI5MTMiCiAgICAgeD0iMCIKICAgICB5PSIwIgogICAgIHdpZHRoPSI0MDAiCiAgICAgaGVpZ2h0PSIzNzUiCiAgICAgeGxpbms6aHJlZj0iI3VzZTI5MDkiIC8+CiAgPHVzZQogICAgIHRyYW5zZm9ybT0ibWF0cml4KDEuMjEzNjQ2MiwwLDAsMS4xNTAxODcsMzQuNzY2NjQyLDYxLjYzMzE4NikiCiAgICAgaWQ9InVzZTI5MTUiCiAgICAgeD0iMCIKICAgICB5PSIwIgogICAgIHdpZHRoPSI0MDAiCiAgICAgaGVpZ2h0PSIzNzUiCiAgICAgeGxpbms6aHJlZj0iI3VzZTI5MDkiIC8+CiAgPHVzZQogICAgIHRyYW5zZm9ybT0idHJhbnNsYXRlKDIxNSw2KSIKICAgICBpZD0idXNlMjkxNyIKICAgICB4PSIwIgogICAgIHk9IjAiCiAgICAgd2lkdGg9IjQwMCIKICAgICBoZWlnaHQ9IjM3NSIKICAgICB4bGluazpocmVmPSIjdXNlMjkxNSIgLz4KICA8dXNlCiAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTQwLjAwMDUsMjg0LjAwMDUpIgogICAgIGlkPSJ1c2UyNDQyIgogICAgIHg9IjAiCiAgICAgeT0iMCIKICAgICB3aWR0aD0iNDAwIgogICAgIGhlaWdodD0iMzc1IgogICAgIHhsaW5rOmhyZWY9IiNwYXRoMTg5MSIgLz4KICA8dXNlCiAgICAgdHJhbnNmb3JtPSJtYXRyaXgoLTEsMCwwLDEsMzE5LjI3MjEsMCkiCiAgICAgaWQ9InVzZTI0NDQiCiAgICAgeD0iMCIKICAgICB5PSIwIgogICAgIHdpZHRoPSI0MDAiCiAgICAgaGVpZ2h0PSIzNzUiCiAgICAgeGxpbms6aHJlZj0iI3VzZTI5MTUiIC8+CiAgPGcKICAgICB0cmFuc2Zvcm09Im1hdHJpeCgxLjE5NjcwMDksMS41Mjk5MjQ5ZS0yLC0yLjE0NTgzNjRlLTIsMC44NTMyMTYyLDIyNC41NTI1MywxMzIuMDI1MDYpIgogICAgIGlkPSJnNDUzNyI+CiAgICA8cGF0aAogICAgICAgZD0iTSAtNTEuNjE4Nzk1LDEzMi40NjIzNyBMIC01MS4yMjEwNDYsMTg3LjA4NjM4IgogICAgICAgaWQ9InBhdGg0NTM5IgogICAgICAgc3R5bGU9ImZpbGw6bm9uZTtmaWxsLW9wYWNpdHk6MC43NTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS4wODg0ODE0MztzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLW9wYWNpdHk6MSIgLz4KICAgIDxwYXRoCiAgICAgICBkPSJNIC01MS4xNjQ0NTIsMTg5LjQ3Mjg2IEwgLTU0Ljg2NDM2MSwxODMuMzE1NTUgTCAtNDcuNDY0NTQyLDE4My4zMTU1NSBMIC01MS4xNjQ0NTIsMTg5LjQ3Mjg2IHoiCiAgICAgICBpZD0icGF0aDQ1NDEiCiAgICAgICBzdHlsZT0iZmlsbDojMDAwMDAwO2ZpbGwtb3BhY2l0eToxO2ZpbGwtcnVsZTpldmVub2RkO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDowLjg3MDc4NTEycHg7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW9wYWNpdHk6MSIgLz4KICA8L2c+CiAgPHRleHQKICAgICB4PSIxNjAuNTk3MTUiCiAgICAgeT0iMzI5LjU3ODYxIgogICAgIGlkPSJ0ZXh0NDU0MyIKICAgICB4bWw6c3BhY2U9InByZXNlcnZlIgogICAgIHN0eWxlPSJmb250LXNpemU6MjRweDtmb250LXN0eWxlOm5vcm1hbDtmb250LXZhcmlhbnQ6bm9ybWFsO2ZvbnQtd2VpZ2h0Om5vcm1hbDtmb250LXN0cmV0Y2g6bm9ybWFsO3RleHQtYWxpZ246Y2VudGVyO2xpbmUtaGVpZ2h0OjEyNSU7d3JpdGluZy1tb2RlOmxyLXRiO3RleHQtYW5jaG9yOm1pZGRsZTtmaWxsOiMwMDAwMDA7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjFweDtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxO2ZvbnQtZmFtaWx5OkFyaWFsIj48dHNwYW4KICAgICAgIHg9IjE2MC41OTcxNSIKICAgICAgIHk9IjMyOS41Nzg2MSIKICAgICAgIGlkPSJ0c3BhbjQ1NDUiPnRlZDwvdHNwYW4+PC90ZXh0PgogIDx0ZXh0CiAgICAgeD0iMTQ5LjQ5NjA5IgogICAgIHk9IjI2OC4xMDQ1NSIKICAgICBpZD0idGV4dDQ1NDciCiAgICAgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIKICAgICBzdHlsZT0iZm9udC1zaXplOjI0cHg7Zm9udC1zdHlsZTpub3JtYWw7Zm9udC12YXJpYW50Om5vcm1hbDtmb250LXdlaWdodDpub3JtYWw7Zm9udC1zdHJldGNoOm5vcm1hbDt0ZXh0LWFsaWduOmNlbnRlcjtsaW5lLWhlaWdodDoxMjUlO3dyaXRpbmctbW9kZTpsci10Yjt0ZXh0LWFuY2hvcjptaWRkbGU7ZmlsbDojMDAwMDAwO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDoxcHg7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MTtmb250LWZhbWlseTpBcmlhbCI+PHRzcGFuCiAgICAgICB4PSIxNDkuNDk2MDkiCiAgICAgICB5PSIyNjguMTA0NTUiCiAgICAgICBpZD0idHNwYW40NTQ5Ij5kPC90c3Bhbj48L3RleHQ+CiAgPHRleHQKICAgICB4PSIxODguNTEwNjgiCiAgICAgeT0iODcuOTg5ODc2IgogICAgIGlkPSJ0ZXh0NDU1MyIKICAgICB4bWw6c3BhY2U9InByZXNlcnZlIgogICAgIHN0eWxlPSJmb250LXNpemU6MjRweDtmb250LXN0eWxlOm5vcm1hbDtmb250LXZhcmlhbnQ6bm9ybWFsO2ZvbnQtd2VpZ2h0Om5vcm1hbDtmb250LXN0cmV0Y2g6bm9ybWFsO3RleHQtYWxpZ246Y2VudGVyO2xpbmUtaGVpZ2h0OjEyNSU7d3JpdGluZy1tb2RlOmxyLXRiO3RleHQtYW5jaG9yOm1pZGRsZTtmaWxsOiMwMDAwMDA7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjFweDtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxO2ZvbnQtZmFtaWx5OkFyaWFsIj48dHNwYW4KICAgICAgIHg9IjE4OC41MTA2OCIKICAgICAgIHk9Ijg3Ljk4OTg3NiIKICAgICAgIGlkPSJ0c3BhbjQ1NTUiPkE8L3RzcGFuPjwvdGV4dD4KICA8dXNlCiAgICAgdHJhbnNmb3JtPSJtYXRyaXgoMS4yNjY2Mjk1LDAsMCwxLjI2NjYyOTUsLTEuODg4NDk3OCwtMjQ3LjAwODE3KSIKICAgICBpZD0idXNlNDU1OSIKICAgICB4PSIwIgogICAgIHk9IjAiCiAgICAgd2lkdGg9IjQwMCIKICAgICBoZWlnaHQ9IjM3NSIKICAgICB4bGluazpocmVmPSIjZzQ1MzciIC8+CiAgPHVzZQogICAgIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAsMTE4KSIKICAgICBpZD0idXNlNDU2MSIKICAgICB4PSIwIgogICAgIHk9IjAiCiAgICAgd2lkdGg9IjQwMCIKICAgICBoZWlnaHQ9IjM3NSIKICAgICB4bGluazpocmVmPSIjcGF0aDE4OTEiIC8+CiAgPHRleHQKICAgICB4PSIyMDAuMDExNzIiCiAgICAgeT0iMTYzLjI1NTg2IgogICAgIGlkPSJ0ZXh0NDU2MyIKICAgICB4bWw6c3BhY2U9InByZXNlcnZlIgogICAgIHN0eWxlPSJmb250LXNpemU6MjRweDtmb250LXN0eWxlOm5vcm1hbDtmb250LXZhcmlhbnQ6bm9ybWFsO2ZvbnQtd2VpZ2h0Om5vcm1hbDtmb250LXN0cmV0Y2g6bm9ybWFsO3RleHQtYWxpZ246Y2VudGVyO2xpbmUtaGVpZ2h0OjEyNSU7d3JpdGluZy1tb2RlOmxyLXRiO3RleHQtYW5jaG9yOm1pZGRsZTtmaWxsOiMwMDAwMDA7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjFweDtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxO2ZvbnQtZmFtaWx5OkFyaWFsIj48dHNwYW4KICAgICAgIHg9IjIwMC4wMTE3MiIKICAgICAgIHk9IjE2My4yNTU4NiIKICAgICAgIGlkPSJ0c3BhbjQ1NjUiPkE8L3RzcGFuPjwvdGV4dD4KICA8dGV4dAogICAgIHg9IjIyOC4zMDA0OSIKICAgICB5PSIyMDAuMDczMDEiCiAgICAgaWQ9InRleHQ0NTg3IgogICAgIHhtbDpzcGFjZT0icHJlc2VydmUiCiAgICAgc3R5bGU9ImZvbnQtc2l6ZToyOHB4O2ZvbnQtc3R5bGU6bm9ybWFsO2ZvbnQtdmFyaWFudDpub3JtYWw7Zm9udC13ZWlnaHQ6bm9ybWFsO2ZvbnQtc3RyZXRjaDpub3JtYWw7dGV4dC1hbGlnbjpjZW50ZXI7bGluZS1oZWlnaHQ6MTI1JTt3cml0aW5nLW1vZGU6bHItdGI7dGV4dC1hbmNob3I6bWlkZGxlO2ZpbGw6IzAwMDA5NDtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MXB4O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjE7Zm9udC1mYW1pbHk6QXJpYWwiPjx0c3BhbgogICAgICAgeD0iMjI4LjMwMDQ5IgogICAgICAgeT0iMjAwLjA3MzAxIgogICAgICAgaWQ9InRzcGFuNDU4OSI+MTU8L3RzcGFuPjwvdGV4dD4KICA8dGV4dAogICAgIHg9IjE3NC42MjQwMiIKICAgICB5PSIzNjYuMjQ5NDgiCiAgICAgaWQ9InRleHQ0NTkxIgogICAgIHhtbDpzcGFjZT0icHJlc2VydmUiCiAgICAgc3R5bGU9ImZvbnQtc2l6ZToyOHB4O2ZvbnQtc3R5bGU6bm9ybWFsO2ZvbnQtdmFyaWFudDpub3JtYWw7Zm9udC13ZWlnaHQ6bm9ybWFsO2ZvbnQtc3RyZXRjaDpub3JtYWw7dGV4dC1hbGlnbjpjZW50ZXI7bGluZS1oZWlnaHQ6MTI1JTt3cml0aW5nLW1vZGU6bHItdGI7dGV4dC1hbmNob3I6bWlkZGxlO2ZpbGw6IzAwMDA5NDtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MXB4O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjE7Zm9udC1mYW1pbHk6QXJpYWwiPjx0c3BhbgogICAgICAgeD0iMTc0LjYyNDAyIgogICAgICAgeT0iMzY2LjI0OTQ4IgogICAgICAgaWQ9InRzcGFuNDU5MyI+NDwvdHNwYW4+PC90ZXh0Pgo8L3N2Zz4K)

对于属性获取，比如要获取属性 `ten`, 只需要按如下顺序 `t -> e -> n` 查找，即可找到值 12.

对于属性更新呢，比如 `data.tea = 14`, 我们要新建一颗树，注意观察，我们并不需要新建所有的结点，只需要新建 root, t, e, a，即可，其余的都可以重用：

![重用旧结点](https://raw.githubusercontent.com/leozcx/leozcx.github.io/master/images/trie2.png)

注意绿色的结点，就是需要新建的结点。

旧的结点可以很快被GC回收：

![GC回收旧结点](https://raw.githubusercontent.com/leozcx/leozcx.github.io/master/images/trie3.png)

这就是Immutable.Map的基本原理：每个结点有32个子结点，每个子结点为0表示尚未设值，为1表示有值，查找时先对属性进行hash，通过选择合适的hash函数，可以保证hash值在[0, 2^32 -1]之间，通过与11111做与运算，可以快速地确定属性应该放在哪一位上；如果当前位已经有值，那么就下钻一层，同时把hash值右移5位，重复同样的操作，直到找到的那个位置还没有设值，则把值放在那个位置。

![Immutalbe.Map]()

实际上当属性个数小于8个时，只用一个数组来保存各个属性。


# 总结

Immutable可以在一定程度上简化我们的开发，特别是与redux结果使用效果更佳。但是不是一定要用Immutable-js呢？未必。当数据量不大时，用 `Object.assin` 可以达到同样的效果，性能也没有太大的下降。当数据量很大时，immutable-js 可以很大程度上提高性能。但同时，它也带来一些不便：只能用immutable-js提供的数据结构。

# 参考资料

- [https://medium.com/@dtinth/immutable-js-persistent-data-structures-and-structural-sharing-6d163fbd73d2](https://medium.com/@dtinth/immutable-js-persistent-data-structures-and-structural-sharing-6d163fbd73d2)